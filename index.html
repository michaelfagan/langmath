<!DOCTYPE html>
<html>
	<meta charset="utf-8">
	<!-- todo
		progression
			ensure questions are not repeated (even if flipped or whichever) within # questions
		math
			add in subtraction
			replace a+b=c model with one where either side of the equals symbol can have 1 or more numbers on it; how to progress?
		sets
			handle missing zero in roman numerals
			? handle feminine gender for portuguese
			? pictograms (eg one apple, two apples)
			american sign language
				use non-animated drawing with 'play' icon beneath
				https://www.wikiwand.com/en/SignWriting
				https://aslfont.github.io/Symbol-Font-For-ASL/ways-to-write.html
				http://www.lifeprint.com/asl101/pages-signs/n/numbers1-10.htm
			braille (english?)
			Gurmukhi numerals (and bengali) are so similar to indian/devanagari numerals
			? morse code
			don't bother with semaphore
			meta sets (.e.g "1+1" for two and a whole set of squares eg sqrt of 0 1 4 9 16 etc)
			etc
		convert to native app
		internationalize
		functionality
			save status
			more gamification? need to research
			distinguish sets, especially important as 3 in indian numerals looks like an 8
		more
			add audio output when clicking on numbers where audio representations exist
			maybe with sound icon
			can get some(all?) on wikipedia, although voices and volumes are inconsistent
		colours, themes, transitions, animations, sound effects
			transition from one question to the next
			animate correct button moving to '?' ?
	-->
	<head>
		<style>
			body {
				font-family: Sans-serif;
				font-size: 5em;
				text-align: center;
				padding: 0;
				margin: 0;
			}
			button {
				font-size: 0.8em;
				margin: 0.3em;
				padding: 0 0.3em;
				height: 2em;
			}
			button span {
				vertical-align: middle;
			}
			button:not([disabled]):hover {
				cursor: pointer;
			}
			button.right, button.wrong {
				color: white;
				background-color: red;
			}
			button.right {
				background-color: green;
				font-weight: bold;
			}
			#question {
				margin: 0.5em 0;
				border-bottom: 2px solid #ccc;
			}
			#question.right, .right #blank {
				color: green;
				font-weight: bold;
			}
			#blank {
				color: #888;
			}
		</style>
	</head>
	<body>

		<p id="question"></p>
		<div id="answers"></div>

		<script>

			function adjustSize(text) {
				// length via // source: https://mathiasbynens.be/notes/javascript-unicode
				var length = text.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g, '_').length;
				return '<span style="font-size:' + (1-((length-1)*0.05)) + 'em">' + text + '</span>';
			}

			var state = {
				number: 2,
				language: 2,
				ordered: true,
				history: []
			};

			var random = function(max, skew_high) {
				if (typeof skew_high === 'undefined') {
					return Math.floor(Math.random() * (max + 1));
				}
				// skews by rolling twice and picking higher
				return Math.floor(Math.max(Math.random() * (max + 1), Math.random() * (max + 1)));
			};
			var numbers = [
				{
					name: 'Arabic numerals',
					numerals: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20']
				},
				{
					name: 'English words',
					numerals: ['zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen', 'twenty']
				},
				{
					name: 'Chinese numerals',
					numerals: ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十']
				},
				{
					name: 'Spanish words',
					numerals: ['cero', 'uno', 'dos', 'tres', 'cuatro',  'cinco', 'seis', 'siete', 'ocho', 'nueve', 'diez', 'once', 'doce', 'trece', 'catorce', 'quince', 'dieciséis', 'diecisiete', 'dieciocho', 'diecinueve', 'veinte']
				},
				/*
				{
					name: 'Roman numerals',
					numerals: [false, 'I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IV', 'X', 'XI', 'XII', 'XIII', 'XIV', 'XV', 'XVI', 'XVII', 'XVIII', 'XIX', 'XX'],
				},
				*/
				{
					name: 'Indian numerals',
					numerals: ['०', '१', '२', '३', '४', '५', '६', '७', '८', '९', '१०', '११', '१२', '१३', '१४', '१५', '१६', '१७', '१८', '१९', '२०']
				},
				{
					name: 'Portuguese words',
					numerals: ['zero', 'um', 'dois', 'três', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove', 'dez', 'onze', 'doze', 'treze', 'catorze', 'quinze', 'dezasseis', 'dezassete', 'dezoito', 'dezanove', 'vinte']
				},
				/*
				{
					name: 'Bengali numerals',
					numerals: ['০', '১', '২', '৪', '৫', '৬', '৭', '৮', '৯', '১০', '১১', '১২', '১৩', '১৪', '১৫', '১৬', '১৭', '১৮', '১৯', '২০']
				},
				*/
				{
					name: 'Russian words',
					numerals: ['ноль', 'один', 'два', 'три', 'четыре', 'пять', 'шесть', 'семь', 'восемь', 'девять', 'десять', 'одиннадцать', 'двенадцать', 'тринадцать', 'четырнадцать', 'пятнадцать', 'шестнадцать', 'семнадцать', 'восемнадцать', 'девятнадцать', 'двадцать']
				},
				{
					name: 'German words',
					numerals: [ 'null', 'eins', 'zwei', 'drei', 'vier', 'fünf', 'sechs', 'sieben', 'acht', 'neun', 'zehn', 'elf', 'zwölf', 'dreizehn', 'vierzehn', 'fünfzehn', 'sechzehn', 'siebzehn', 'achtzehn', 'neunzehn', 'zwanzig']
				}
			];
			var equation = document.getElementById('question');
			var answers = document.getElementById('answers');
			var button_for = function(n, answer) {
				var text = adjustSize(numbers[random(state.language)].numerals[n]);
				return '<button data-correct="' + (n === answer) + '">' + text + '</button>';
			};
			function increaseLevel() {
				if (state.ordered) {
					state.ordered = false;
				}
				else if (state.number < 10) {
					state.number +=2;
					state.ordered = true;
				}
				else if (state.language <= numbers.length) {
					state.number = 2;
					state.ordered = true;
					state.language++;
				}
			}
			function decreaseLevel() {
				if (!state.ordered) {
					state.ordered = true;
				}
				else if (state.number > 2) {
					state.number -=2;
					state.ordered = false;
				}
				else if (state.language > 2) {
					state.language--;
					numberes_ordered = false;
					state.number = 10;
				}
			}
			function adjustLevel(){
				if (state.history.length < 4) {
					return;
				}

				// level up
				var right_streak = state.history.findIndex(function(n){
					return n !== 0;
				});
				right_streak = right_streak !== -1 ? right_streak : state.history.length;
				// advance after 4 more correct in a row
				if (right_streak && right_streak % 4 === 0) {
					increaseLevel();
					// advance extra after 12 more correct in a row
					if (right_streak % 12 === 0) {
						increaseLevel();
					}
				}

				// level down
				else if (!right_streak && state.history.length > 2) {
					// if they've made 3 mistakes each in the last 3 questions
					if (state.history[0] >=3 && state.history[1] >=3 && state.history[2] >=3) {
						decreaseLevel();
					}
					// if they haven't gotten a perfect answer in the last 5 questions
					else if (state.history.length > 5) {
						var last_correct = state.history.findIndex(function(n){
							return n === 0;
						});
						if (last_correct === -1 || last_correct > 5) {
							decreaseLevel();
						}
					}
				}

				// no need to store older history
				if (state.history.length === 24) {
					state.history.splice(12, 12);
				}
			}
			function ask() {
				adjustLevel();
				var q = [random(state.number, true), random(state.number, true)];
				q.push(q[0] + q[1]);
				var blank = random(2);
				var answer = q[blank];
				equation.classList.remove('right');
				var q_disp = q.map(function(num, i){
					return i === blank ? '<span id="blank">?</span>' : adjustSize(numbers[random(state.language, true)].numerals[num]);
				});
				equation.innerHTML = q_disp[0] + ' + ' + q_disp[1];
				if (random(1)) {
					equation.insertAdjacentHTML('beforeend', ' = ' + q_disp[2]);
				}
				else {
					equation.insertAdjacentHTML('afterbegin', q_disp[2] + ' = ');
				}
				var buttons = [];
				for (var i=0; i<=(state.number*2); i++) {
					buttons.push(button_for(i, answer));
				}
				if (!state.ordered) {
					// add duplicate numbers from different sets
					var num_buttons = buttons.length * 1.5;
					while (buttons.length < num_buttons) {
						var button = button_for(random(state.number*2), answer);
						if (buttons.indexOf(button) === -1) {
							buttons.push(button);
						}

					}
					// randomize order
					var buttons_random = [];
					while (buttons.length) {
						var i = random(buttons.length-1);
						buttons_random.push(buttons[i]);
						buttons.splice(i, 1);
					}
					buttons = buttons_random;
				}
				answers.innerHTML = buttons.join('');
				state.history.unshift(0);
			};
			answers.addEventListener('click', function(e){
				var elm = e.target;
				if (elm.tagName.toLowerCase() === 'span') {
					elm = elm.parentElement;
				}
				if (elm.tagName.toLowerCase() === 'button') {
					elm.setAttribute('disabled', 'disabled');
					if (elm.getAttribute('data-correct') === 'true') {
						elm.classList.add('right');
						document.getElementById('blank').innerHTML = elm.textContent;
						if (answers.querySelectorAll("[data-correct='true']:not(:disabled)").length === 0) {
							equation.classList.add('right');
							setTimeout(ask, 1000);
						}
					}
					else {
						elm.classList.add('wrong');
						state.history[0]++;
					}
				}
			});

			ask();
		</script>

	</body>
</html>